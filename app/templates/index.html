{% extends "base.html" %}

{% block title %}Dom≈Ø - Ko≈°t V√≠n{% endblock %}

{% block content %}
<div class="container-lg">
    
    <div class="page-header-row">
        <div>
            <h2 class="page-title">V√≠tejte na str√°nk√°ch ko≈°tu</h2>

            <div style="color: #666; font-weight: normal; font-size: 1.1rem; margin-top: 4px;">
                {{ rocnik_nazev }}
            </div>
        </div>
    </div>
        
    <div style="margin-bottom: 20px;">
        <input type="text" id="searchInput" onkeyup="filterTable()" 
           placeholder="üîç Hledat v√≠no nebo vina≈ôe..." 
           class="form-control" 
           style="max-width: 100%; border: 2px solid #eee;">
    </div>

    <div class="card" style="padding: 0;">
        <table class="data-table" id="winesTable">
            <thead>
                <tr>
                    <th class="sortable" onclick="sortTable(0)">N√°zev v√≠na ‚Üï</th>
                    <th class="sortable" onclick="sortTable(1)">Vina≈ô ‚Üï</th>
                    <th class="sortable" onclick="sortTable(2)">Barva ‚Üï</th>
                    <th class="sortable" onclick="sortTable(3)">Sladkost ‚Üï</th>
                    <th class="sortable" onclick="sortTable(4)">Hodnocen√≠ ‚Üï</th>
                </tr>
            </thead>
    
            <tbody>
                {% for vino in wines %}
                <tr>
                    <td class="text-bold"><a href="/vino/{{ vino.id }}" class="link-wine">{{ vino.nazev }}</a></td>
                    <td><a href="/vinar/{{ vino.vinar.id }}" class="link-vinar">{{ vino.vinar.jmeno }}</a></td>
                    <td>{{ vino.barva.value }}</td>
                    <td class="text-muted">{{ vino.sladkost.value }}</td>
                    <td class="text-right">
                        {% if vino.prumer_body %}
                            <span style="font-weight: bold; color: #2ecc71; font-size: 1.1rem;">
                                {{ "%.1f"|format(vino.prumer_body) }} b.
                            </span>
                            <small style="color: #bbb; margin-left: 5px;">({{ vino.pocet_hodnoceni }}x)</small>
                        {% else %}
                            <span style="color: #ccc; font-size: 0.9rem;">Nehodnoceno</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function filterTable() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("winesTable");
        tr = table.getElementsByTagName("tr");

        for (i = 1; i < tr.length; i++) {
            var tdName = tr[i].getElementsByTagName("td")[0];
            var tdVinar = tr[i].getElementsByTagName("td")[1];
            
            if (tdName || tdVinar) {
                var txtName = tdName.textContent || tdName.innerText;
                var txtVinar = tdVinar.textContent || tdVinar.innerText;
                
                if (txtName.toUpperCase().indexOf(filter) > -1 || txtVinar.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }       
        }
    }

    function sortTable(n) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("winesTable");
        switching = true;
        dir = "asc";

        while (switching) {
            switching = false;
            rows = table.rows;
            for (i = 1; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                
                var xContent = x.innerHTML.toLowerCase();
                var yContent = y.innerHTML.toLowerCase();

                if (dir == "asc") {
                    if (xContent > yContent) { shouldSwitch = true; break; }
                } else if (dir == "desc") {
                    if (xContent < yContent) { shouldSwitch = true; break; }
                }
            }
            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                switchcount ++;      
            } else {
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }
</script>

{% endblock %}